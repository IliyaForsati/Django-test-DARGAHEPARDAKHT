(function(){var n=!1,t=[],i=function(){if(!n&&t.length!==0){n=!0;try{var r=t.shift();$.ajax({type:"POST",contentType:"application/json",url:"https://landing.asanpardakht.ir/webappmonitoring/api/logger",data:JSON.stringify(r),complete:function(){n=!1;i()}})}catch(u){n=!1;i()}}},r=function(r,u,f,e,o){try{var s={AppName:"IPG",Type:"Error",Message:r,Url:u,Line:f,"Column:":e,Error:JSON.stringify(o)};t.push(s);i()}catch(h){n=!1}};window.onerror=function(n,t,i,u,f){return r(n,t,i,u,f),!1}})(),function(n){var t=[{bin:"627412",nameFa:"اقتصادنوین",logo:"ic_bank_en.png"},{bin:"627381",nameFa:"انصار",logo:"ic_bank_ansar.png"},{bin:"505785",nameFa:"ایران زمین",logo:"ic_bank_iran_zamin.png"},{bin:"622106",nameFa:"پارسیان",logo:"ic_bank_parsian.png"},{bin:"639194",nameFa:"پارسیان",logo:"ic_bank_parsian.png"},{bin:"627884",nameFa:"پارسیان",logo:"ic_bank_parsian.png"},{bin:"622108",nameFa:"پارسیان",logo:"ic_bank_parsian.png"},{bin:"639347",nameFa:"پاسارگاد",logo:"ic_bank_pasargad.png"},{bin:"502229",nameFa:"پاسارگاد",logo:"ic_bank_pasargad.png"},{bin:"636214",nameFa:"آینده",logo:"ic_bank_ayande.png"},{bin:"585983",nameFa:"تجارت",logo:"ic_bank_tejarat.png"},{bin:"627353",nameFa:"تجارت",logo:"ic_bank_tejarat.png"},{bin:"502908",nameFa:"توسعه تعاون",logo:"ic_bank_tosee.png"},{bin:"627648",nameFa:"توسعه صادرات",logo:"ic_bank_tosee_saderat.png"},{bin:"207177",nameFa:"توسعه صادرات",logo:"ic_bank_tosee_saderat.png"},{bin:"636949",nameFa:"حکمت ایرانیان",logo:"ic_bank_hekmat_iranian.png"},{bin:"502938",nameFa:"دی",logo:"ic_bank_day.png"},{bin:"504172",nameFa:"رسالت",logo:"ic_bank_resalat.png"},{bin:"589463",nameFa:"رفاه",logo:"ic_refah_bank.png"},{bin:"621986",nameFa:"سامان",logo:"ic_bank_saman.png"},{bin:"589210",nameFa:"سپه",logo:"ic_bank_sepah.png"},{bin:"604932",nameFa:"سپه",logo:"ic_bank_sepah.png"},{bin:"639607",nameFa:"سرمایه",logo:"ic_bank_sarmaye.png"},{bin:"639346",nameFa:"سینا",logo:"ic_bank_sina.png"},{bin:"502806",nameFa:"شهر",logo:"ic_bank_shahr.png"},{bin:"504706",nameFa:"شهر",logo:"ic_bank_shahr.png"},{bin:"603769",nameFa:"صادرات",logo:"ic_bank_saderat.png"},{bin:"627961",nameFa:"صنعت و معدن",logo:"ic_bank_sanat_madan.png"},{bin:"606373",nameFa:"مهر ایران",logo:"ic_bank_mehr_iran.png"},{bin:"639599",nameFa:"قوامین",logo:"ic_bank_ghavamin.png"},{bin:"627488",nameFa:"کار آفرین",logo:"ic_bank_karafarin.png"},{bin:"502910",nameFa:"کار آفرین",logo:"ic_bank_karafarin.png"},{bin:"603770",nameFa:"کشاورزی",logo:"ic_bank_keshavarzi.png"},{bin:"639217",nameFa:"کشاورزی",logo:"ic_bank_keshavarzi.png"},{bin:"505416",nameFa:"گردشگری",logo:"ic_bank_gardeshgari.png"},{bin:"636795",nameFa:"مرکزی",logo:"ic_bank_central.png"},{bin:"628023",nameFa:"مسکن",logo:"ic_bank_maskan.png"},{bin:"610433",nameFa:"ملت",logo:"ic_bank_mellat.png"},{bin:"991975",nameFa:"ملت",logo:"ic_bank_mellat.png"},{bin:"603799",nameFa:"ملی",logo:"ic_bank_melli.png"},{bin:"639370",nameFa:"مهر اقتصاد",logo:"ic_bank_mehr_eghtesad.png"},{bin:"627760",nameFa:"پست بانک",logo:"ic_post_bank.png"},{bin:"628157",nameFa:"اعتباری توسعه",logo:"ic_tosee_finance.png"},{bin:"505801",nameFa:"اعتباری کوثر",logo:"ic_bank_kousar.png"},{bin:"606256",nameFa:"اعتباری ملل",logo:"ic_bank_asgariye.png"},{bin:"936450",nameFa:"سامانه رفع مغایرت",logo:"ic_bank_empty.png"},{bin:"983254",nameFa:"پرشین سوئیچ",logo:"ic_bank_asan_pardakht.png"},{bin:"000000",nameFa:"کیف پول آپ",logo:"ic_bank_asan_pardakht.png"},{bin:"581672",nameFa:"شاپرک",logo:"shaparak_icon_blue.png"},{bin:"585947",nameFa:"خاورمیانه",logo:"ic_bank_khavarmianeh.png"}];n.fetchBankData=function(n){var i=$(t).filter(function(t,i){return i.bin===n});return i[0]}}(window.bincode=window.bincode||{}),function(n){function r(){var n=Object.create(Object.prototype);return $.fn.valid=function(){if($(this).is("form")){i=$(this);$(this).attr("novalidate","novalidate");this.on("submit",function(n){n.preventDefault()});validator.reset();t=!0}else $(this).is("div")&&(i=$(this),validator.reset(),t=!0);return(validator.checkRequiredRules(),!t)?(validator.errors.required(),t):(validator.checkPaternRules(),!t)?(validator.errors.pattern(),t):(validator.checkCardRules(),!t)?(validator.errors.pan(),t):t},$.fn.reset=function(){if($(this).is("form")){i=$(this);$(this).attr("novalidate","novalidate");this.on("submit",function(n){n.preventDefault()});validator.reset();t=!0}else $(this).is("div")&&(i=$(this),validator.reset(),t=!0)},n}var i,t;typeof n.validator=="undefined"&&(n.validator=r());$.extend(n.validator,{errors:{requiredList:[],required:function(){$(validator.errors.requiredList).each(function(n,t){$(t.element).addClass("error")})},addRequired:function(n,t){validator.errors.requiredList.push({message:"*",element:t})},patternList:[],pattern:function(){var n=[];$(validator.errors.patternList).each(function(t,i){$(i.element).addClass("error");$(i.element).attr("pattern-msg")!==undefined&&n.push($(i.element).attr("pattern-msg"))});n.length>0&&messageBox.clear().addErrors(n).show()},addPattern:function(n,t){validator.errors.patternList.push({message:"*",element:t})},panList:[],pan:function(){$(validator.errors.panList).each(function(n,t){$(t).addClass("error")});messageBox.clear().addError("شماره کارت معتبر نمی باشد.").show()},addPan:function(n){validator.errors.panList=n}},elements:function(){return $(i).find("input, select, textarea").not(":submit, :reset, :image, :disabled")},elementsDisabledIncluded:function(){return $(i).find("input, select, textarea").not(":submit, :reset, :image")},methods:{required:function(n){return n.length>0},email:function(n,t){return this.optional(t)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(n)},pattern:function(n,t){return validator.optional(t)||new RegExp($(t).attr("pattern"),"g").test(validator.elementValue(t))},creditcard:function(n){var i,f,r,u,t;if(n.match(/\*{6}/g)||n.match(/آپ/g)||(i=n.length,0===i||19===i))return!0;if(16>i||0===parseInt(n.substr(1,10),10)||0===parseInt(n.substr(10,6),10)||"639370"===n.substr(0,6))return!1;if("639599"===n.substring(0,6)||"505801"===n.substring(0,6))return!0;for(u=0,t=0;16>t;t++)f=t%2==0?2:1,r=parseInt(n.substr(t,1),10)*f,u+=r>9?r-9:r;return u%10==0}},elementValue:function(n){var u=$(n),r=n.type,t,i;return r==="radio"||r==="checkbox"?this.findByName(n.name).filter(":checked").val():r==="number"&&typeof n.validity!="undefined"?n.validity.badInput?"NaN":u.val():(t=n.hasAttribute("contenteditable")?u.text():u.val(),r==="file")?t.substr(0,12)==="C:\\fakepath\\"?t.substr(12):(i=t.lastIndexOf("/"),i>=0)?t.substr(i+1):(i=t.lastIndexOf("\\"),i>=0)?t.substr(i+1):t:typeof t=="string"?t.replace(/\r/g,""):t},checkRules:function(){return validator.elements().each(function(){}),!1},checkRequiredRules:function(){validator.elements().each(function(n,i){if($(i).attr("required")!==undefined){var r=validator.methods.required.call(this,validator.elementValue(i),i);r||(t=!1,validator.errors.addRequired.call(this,"*",i))}})},checkPaternRules:function(){validator.elements().each(function(n,i){if($(i).attr("pattern")!==undefined){var r=validator.methods.pattern.call(this,validator.elementValue(i),i);r||(t=!1,validator.errors.addPattern.call(this,"*",i))}})},checkCardRules:function(){var n="",i;panElements=[];validator.elements().each(function(t,i){$(i).attr("card-grp")!==undefined&&(n+=validator.elementValue(i),panElements.push(i))});i=validator.methods.creditcard.call(this,n);i||(t=!1,validator.errors.addPan.call(this,panElements))},optional:function(n){var t=validator.elementValue(n);return!validator.methods.required.call(this,t,n)},reset:function(){validator.errors.requiredList=[];validator.errors.patternList=[];$(validator.elementsDisabledIncluded()).removeClass("error")}})}(window),function(n){var i=$(".notification"),t;i.html('<ul class="notification-alert"><\/ul>');t=$(".notification>.notification-alert");n.addError=function(i){return $(t).attr("class","notification-alert notification-alert-danger"),$(t).append("<li>"+i+"<\/li>"),n};n.addErrors=function(t){return $(t).each(function(t,i){n.addError(i)}),n};n.addWarn=function(i){return $(t).attr("class","notification-alert notification-alert-warning"),$(t).append("<li>"+i+"<\/li>"),n};n.addWarns=function(t){$(t).each(function(t,i){n.addWarn(i)})};n.addSuccess=function(i){return $(t).attr("class","notification-alert notification-alert-success"),$(t).append("<li>"+i+"<\/li>"),n};n.show=function(){return i.show("slow",function(){}),n};n.hide=function(){return i.hide(),n};n.clear=function(){return i.hide(),$(t).html(""),n};$(function(){i.hide()})}(window.messageBox=window.messageBox||{}),function(n){n.isMobileBrowser=function(){return $(window).width()<768};n.keyCodes={back:8,tab:9,enter:13,arrowDown:40,arrowUp:38};n.toPersianNumber=function(n){if(!n)return"";var t=$.trim(n.toString());return t?t.replace(/0/g,"۰").replace(/1/g,"۱").replace(/2/g,"۲").replace(/3/g,"۳").replace(/4/g,"۴").replace(/5/g,"۵").replace(/6/g,"۶").replace(/7/g,"۷").replace(/8/g,"۸").replace(/9/g,"۹"):""};n.isWalletCard=function(n){return n.type==="IPGWALLET"};n.isQRCodeCard=function(n){return n.type==="IPGQRCODE"};n.toEnglishNumber=function(n){if(!n)return"";var t=$.trim(n.toString());return t?t.replace(/\u0660/g,"0").replace(/\u06F0/g,"0").replace(/\u0661/g,"1").replace(/\u06F1/g,"1").replace(/\u0662/g,"2").replace(/\u06F2/g,"2").replace(/\u0663/g,"3").replace(/\u06F3/g,"3").replace(/\u0664/g,"4").replace(/\u06F4/g,"4").replace(/\u0665/g,"5").replace(/\u06F5/g,"5").replace(/\u0666/g,"6").replace(/\u06F6/g,"6").replace(/\u0667/g,"7").replace(/\u06F7/g,"7").replace(/\u0668/g,"8").replace(/\u06F8/g,"8").replace(/\u0669/g,"9").replace(/\u06F9/g,"9"):""};n.scrollTop=function(t){n.isMobileBrowser()&&$([document.documentElement,document.body]).animate({scrollTop:t},1e3)};n.getBase=function(){return $(document.body).data("base")};n.decodeHtml=function(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value};n.secondsToPersianMinutesSeconds=function(t){return n.toPersianNumber(parseInt(t/60,10)+":"+t%60)};n.getMasked=function(n){return n.substr(0,6)+n.substr(6,6).replace(/./g,"*")+n.substr(12,4)};n.toCommaSeprated=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};n.fromCommaSeprated=function(n){return Number(n.replace(/,/g,""))};n.isAllowedKey=function(n,t,i){var r=n.key||String.fromCharCode(n.which||n.keyCode);return t&&/^[\u0660-\u0669\u06F0-\u06F90-9]*$/.test(r)?!0:$(i).filter(function(t,i){return n.which===i}).length>0?!0:!1};n.antiforgery={antiforgeryElementName:"AntiforgeryField",antiforgeryElement:$("input[name=AntiforgeryField]"),headerPropName:"X-CSRF-TOKEN"};n.CallMerchantCallbackUrl=function(t,i,r,u,f){var e,s,o,h;f=f||4e3;e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("action",t);for(s in i)i.hasOwnProperty(s)&&(o=document.createElement("input"),o.setAttribute("type","hidden"),o.setAttribute("name",s),o.setAttribute("value",i[s]),e.appendChild(o));document.body.appendChild(e);h=!1;e.submit();setTimeout(function(){if(!h){var t={};t[n.antiforgery.headerPropName]=n.antiforgery.antiforgeryElement.val();$.ajax({url:n.getBase()+"api/default/log-callback",type:"POST",headers:t,data:JSON.stringify({MerchantCode:r,PaygateTranId:u}),contentType:"application/json; charset=utf-8",success:function(){},error:function(){}})}},f)};n.createAndSubmitForm=function(t,i,r,u){var f,e,s,o;r=r||"post";f=document.createElement("form");f.setAttribute("method",r);f.setAttribute("action",t);u&&(e=document.createElement("input"),e.setAttribute("type","hidden"),e.setAttribute("name",n.antiforgery.antiforgeryElementName),e.setAttribute("value",n.antiforgery.antiforgeryElement.val()),f.appendChild(e));for(s in i)i.hasOwnProperty(s)&&(o=document.createElement("input"),o.setAttribute("type","hidden"),o.setAttribute("name",s),o.setAttribute("value",i[s]),f.appendChild(o));document.body.appendChild(f);f.submit()};n.serviceType={buy:1,bill:3,jud:50,wallet:51,iranInsurance:52,pensionFund:121,sabtAsnad:53,telecomChargeMci:61,telecomChargeIrancell:62,telecomChargeRightel:64,telecomChargeAptel:65,telecomChargeAzartel:66,telecomChargeShatel:67,telecomBoltonMci:71,telecomBoltonIrancell:72,telecomBoltonRightel:74,telecomBoltonAptel:75,telecomBoltonAzartel:76,telecomBoltonShatel:77,telecomChargePinMci:91,telecomChargePinIrancell:92,telecomChargePinRightel:94};n.iranInsuranceCustomPostback=function(t,i){var r={reqGadget:i.gadget,reqAction:i.action,gateway:i.gateway,referenceId:i.referenceId,controlCode:i.controlCode,status:i.status,merchantShaparakFee:i.merchantShaparakFee};n.createAndSubmitForm(n.decodeHtml(t),r,"get",!1)};n.pensionFundCustomPostback=function(t,i){var r={reqGadget:i.gadget,reqAction:i.action,gateway:i.gateway,referenceId:i.referenceId,controlCode:i.controlCode,status:i.status,merchantShaparakFee:i.merchantShaparakFee};n.createAndSubmitForm(n.decodeHtml(t),r,"get",!1)}}(window.ipgcommon=window.ipgcommon||{}),function(n){var r={isScrolling:!1,helperDiv:{helperDiv:$("#helper-div"),cardItemNew:$("#helper-div .card-item-new"),cardItem:$("#helper-div .card-item")}},t={manageDynamicSecondPass:function(n){if(n.length===16){var i=n.substr(6,2);i.substr(0,1)==="2"||i.substr(0,1)==="3"?(t.dynamicSecondPassWrapper.fadeOut(),t.dynamicSecondPassGiftCardWrapper.fadeIn()):(t.cardHistory.isAllowd(n)?(t.timers.secondPassTimeoutTime=-1,t.cardHistory.history.length!==0&&t.refreshCaptcha(),t.pan.pAll.prop("disabled",!1),t.cvv2.prop("disabled",!1),t.cvv2.keypad("enable"),t.expiryMonth.prop("disabled",!1),t.expiryYear.prop("disabled",!1),t.changeExpBtn.prop("disabled",!1),t.sendDynamicSecondPassBtn.prop("disabled",!1),t.sendDynamicSecondPassBtn.text("درخواست رمز پویا"),t.sendDynamicSecondPassBtn.removeClass("button_loading")):(t.sendDynamicSecondPassBtn.prop("disabled",!0),t.timers.secondPassTimeoutTime=t.cardHistory.getTimeoutTime(n)),t.dynamicSecondPassWrapper.fadeIn(),t.dynamicSecondPassGiftCardWrapper.fadeOut())}},onCardNumberChanged:function(n){var i=bincode.fetchBankData(n.substr(0,6));i?($(".bincode").empty(),$(".bincode").append(i.nameFa)):$(".bincode").empty();t.manageDynamicSecondPass(n)},pan:{pAll:$(".pan4"),p1:$("#pan1-4"),p2:$("#pan2-4"),p3:$("#pan3-4"),p4:$("#pan4-4"),selectedCard:undefined,getPan:function(){return t.pan.selectedCard?"":t.pan.pAll.map(function(n,t){return t.value}).get().join("")},getToken:function(){return t.pan.selectedCard?t.pan.selectedCard.token:""},getPanShowingText:function(){return t.pan.pAll.map(function(n,t){return t.value}).get().join("")}},disableExpiry:function(){t.expiryMonth.addClass("pass");t.expiryMonth.prop("disabled",!0);t.expiryMonth.val("**");t.expiryYear.addClass("pass");t.expiryYear.prop("disabled",!0);t.expiryYear.val("**");t.changeExpBtn.fadeIn();t.saveCardCheckbox.prop("checked",!1).removeClass("checked");t.saveCardCheckbox.parent().fadeOut()},enableExpiry:function(){t.expiryMonth.val("");t.expiryMonth.prop("disabled",!1);t.expiryMonth.removeClass("pass");t.expiryYear.val("");t.expiryYear.prop("disabled",!1);t.expiryYear.removeClass("pass");t.changeExpBtn.fadeOut();n.canStoreCards&&(t.saveCardCheckbox.prop("checked",!0).addClass("checked"),t.saveCardCheckbox.parent().fadeIn())},cardElements:{wrapper:$("ul.cards-wrapper"),getNew:function(){return $("ul.cards-wrapper .card-item-new")},getAll:function(){return $("ul.cards-wrapper .card-item")},getHidden:function(){return $("ul.cards-wrapper .card-item:hidden")},getActive:function(){return $("ul.cards-wrapper .card-item:visible")},setBankNameHolderTo:function(n,t){n.find(".bank-name-holder").text(t)},setBankImgHolderTo:function(n,t){n.find(".bank-img-holder").prop("src",t)},getCardNumberFrom:function(n){return n.find(".card-number-holder .search-matched").text()+n.find(".card-number-holder .search-not-matched").text()},setCardNumberTo:function(n,t,i){n.find(".card-number-holder .search-matched").text(t);n.find(".card-number-holder .search-not-matched").text(i)},resetCardNumbers:function(){t.cardElements.getAll().each(function(n,i){t.cardElements.setCardNumberTo($(i),"",t.cardElements.getCardNumberFrom($(i)))})},canShowWrapper:function(){return n.cards&&n.cards.length>0},getMvmCard:function(t){var i=$(n.cards).filter(function(n,i){return i.token===t.prop("id")});return i[0]},select:function(i){ipgcommon.scrollTop(t.pan.p1.closest("form").offset().top);var r=t.cardElements.getMvmCard(i),u=r.bin+"******"+r.lastDigits;t.cardElements.resetCardNumbers();ipgcommon.isWalletCard(r)?(t.pan.p4.val("کیف "),t.pan.p3.val("پول "),t.pan.p2.val("آپ  "),t.pan.p1.val("    "),t.cvv2Wrapper.fadeOut(),t.expWrapper.fadeOut(),t.cvv2.val("1111"),t.expiryMonth.val("11"),t.expiryYear.val("11"),t.captcha.focus()):ipgcommon.isQRCodeCard(r)?ipgcommon.createAndSubmitForm(ipgcommon.getBase()+"qrcode",{RefId:n.refId,mobileap:n.mobile},"post",!1):(t.pan.p1.val(u.substr(0,4)),t.pan.p2.val(u.substr(4,4)),t.pan.p3.val(u.substr(8,4)),t.pan.p4.val(u.substr(12,4)),t.cvv2Wrapper.fadeIn(),t.expWrapper.fadeIn(),t.cvv2.focus());t.disableExpiry();t.pan.selectedCard=r;t.cardElements.wrapper.fadeOut();t.pan.pAll.prop("readonly",!0);t.onCardNumberChanged(u)},unSelect:function(){t.cardElements.resetCardNumbers();t.pan.selectedCard=undefined;t.pan.pAll.val("");t.pan.pAll.prop("readonly",!1);t.pan.p1.focus();t.cvv2Wrapper.fadeIn();t.expWrapper.fadeIn();t.secondPass.val("");t.cvv2.val("");t.enableExpiry();t.cardElements.wrapper.fadeIn();t.cardElements.getHidden().each(function(n,t){$(t).fadeIn()})},sortCards:function(){var t,i;try{if(t=window.localStorage.getItem("lastUsedCards"),!t)return;if(t=t.split(","),!$.isArray(t))return;t=$(t).filter(function(n,i){return t.indexOf(i)===n}).toArray().reverse();i=n.cards.slice().sort(function(n,i){return t.indexOf(n.lastDigits)-t.indexOf(i.lastDigits)}).reverse();n.cards=i}catch(r){return}},addToLastUsedCards:function(n){if(n)try{var t=window.localStorage.getItem("lastUsedCards")||"";t=t.length?t.split(","):[];t=$(t).filter(function(t,i){return i!==n}).toArray();t.unshift(n);t=t.slice(0,9).join(",");window.localStorage.removeItem("lastUsedCards");window.localStorage.setItem("lastUsedCards",t)}catch(i){return}},parseCards:function(){t.cardElements.sortCards();$(n.cards).each(function(n,i){var u=r.helperDiv.cardItem.clone().prop("id",i.token),f;ipgcommon.isWalletCard(i)?t.cardElements.setCardNumberTo(u,"","    کیف پول آپ  "):ipgcommon.isQRCodeCard(i)?t.cardElements.setCardNumberTo(u,"","    QRCode  "):t.cardElements.setCardNumberTo(u,"",i.bin+"******"+i.lastDigits);t.cardElements.setBankNameHolderTo(u,i.bankName);f=bincode.fetchBankData(i.bin);f&&t.cardElements.setBankImgHolderTo(u,"images/ic_bank/"+f.logo);t.cardElements.wrapper.append(u)});t.cardElements.getAll().each(function(n,i){$(i).bind("touchend click",function(n){r.isScrolling||$(n.target).closest("#delete-card").length||t.cardElements.select($(i))});$(i).bind("keydown",function(n){n.which===ipgcommon.keyCodes.enter?(t.cardElements.select($(i)),n.preventDefault()):n.which===ipgcommon.keyCodes.arrowDown?($(i).next().focus(),n.preventDefault()):n.which===ipgcommon.keyCodes.arrowUp&&($(i).prev().focus(),n.preventDefault())})})},init:function(){t.cardElements.canShowWrapper()&&(t.cardElements.wrapper.append(r.helperDiv.cardItemNew.clone()),t.cardElements.getNew().bind("touchend click",function(){r.isScrolling||t.cardElements.unSelect()}),t.cardElements.getNew().bind("keydown",function(n){n.which===ipgcommon.keyCodes.enter?(t.cardElements.unSelect(),n.preventDefault()):n.which===ipgcommon.keyCodes.arrowDown?(t.cardElements.getNew().next().focus(),n.preventDefault()):n.which===ipgcommon.keyCodes.arrowUp&&(t.cardElements.unSelect(),t.pan.p1.focus(),n.preventDefault())}),t.cardElements.parseCards(),t.cardElements.wrapper.fadeIn());r.helperDiv.helperDiv.remove()}},cardHistory:{history:[],add:function(n,i){n.length===16&&(n=ipgcommon.getMasked(n),t.cardHistory.history.push({cardNumber:n,timeoutTime:i}))},isAllowd:function(n){n=ipgcommon.getMasked(n);var r=$.now()+2e3,i=$(t.cardHistory.history).filter(function(t,i){return i.cardNumber===n}).sort(function(n,t){return t.timeoutTime-n.timeoutTime}).toArray();return i.length===0||i[0].timeoutTime<r?!0:!1},getTimeoutTime:function(n){n=ipgcommon.getMasked(n);var i=$(t.cardHistory.history).filter(function(t,i){return i.cardNumber===n}).sort(function(n,t){return t.timeoutTime-n.timeoutTime});return i.length===0?-1:i[0].timeoutTime}},mainPage:$("#main-page"),ipgHelpPage:$("#ipg-help-page"),secondPassHelpPage:$("#second-pass-help-page"),securityInfoPage:$("#security-info-page"),expWrapper:$("#exp-wrapper"),expiryMonth:$("#expiry-month"),expiryYear:$("#expiry-year"),saveCardCheckbox:$("#save-card-checkbox"),cancelBtn:$("#cancel-btn"),changeExpBtn:$("#change-exp-btn"),confirmBtn:$("#confirm-btn"),sendDynamicSecondPassBtn:$("#send-dynamic-second-pass-btn"),secondPass:$("#second-pass"),dynamicSecondPassWrapper:$("#dynamic-second-pass-wrapper"),dynamicSecondPassGiftCardWrapper:$("#dynamic-second-pass-gift-card-wrapper"),cvv2Wrapper:$("#cvv2-wrapper"),cvv2:$("#cvv2"),captchaWrapper:$("#captcha-wrapper"),captcha:$("#captcha"),captchaImage:$("#captcha-image"),captchaImageRefresh:$("#captcha-image-refresh"),captchaAudioPlay:$("#captcha-audio-play"),phoneNumber:$("#phone-number"),mailAddress:$("#mail-address"),notification:$(".notification"),refreshCaptcha:function(){var i={};i[ipgcommon.antiforgery.headerPropName]=ipgcommon.antiforgery.antiforgeryElement.val();$.ajax({url:ipgcommon.getBase()+"api/default/getcaptcha",type:"POST",headers:i,data:JSON.stringify({RefId:n.refId}),contentType:"application/json; charset=utf-8",success:function(n){if(t.captchaImage.attr("src","data:image/jpeg;charset=utf-8;base64, "+n.imageBase64),t.captcha.val(""),t.captchaWrapper.fadeIn(),t.audioCaptcha){try{t.audioCaptcha.pause()}catch(i){console.log(i)}t.audioCaptcha=null}},error:function(n){if(t.captcha.val(""),t.captchaImage.attr("src",""),n.status===409){var i=n.responseJSON;messageBox.clear().addError(i.errorString).show();ipgcommon.scrollTop(t.notification.offset().top+100-$(window).height())}else throw"Failed to Refresh Captcha: "+n.status+" "+JSON.stringify(n);}})},playCaptcha:function(){if(t.audioCaptcha)t.audioCaptcha.pause(),t.audioCaptcha.currentTime=0,setTimeout(function(){t.audioCaptcha.play()},800);else{var i={};i[ipgcommon.antiforgery.headerPropName]=ipgcommon.antiforgery.antiforgeryElement.val();$.ajax({url:ipgcommon.getBase()+"api/default/getaudio",type:"POST",headers:i,data:JSON.stringify({RefId:n.refId}),contentType:"application/json; charset=utf-8",success:function(n){var i="data:audio/mpeg;base64,"+n.audioBase64;t.audioCaptcha=new Audio(i);t.audioCaptcha.play()},error:function(n){if(t.audioCaptcha=null,n.status===409){var i=n.responseJSON;messageBox.clear().addError(i.errorString).show();ipgcommon.scrollTop(t.notification.offset().top+100-$(window).height())}else throw"Failed to Play Captcha: "+n.status+" "+JSON.stringify(n);}})}},timers:{ipgTimeoutTime:-1,secondPassTimeoutTime:-1,startTimer:function(){var n=setInterval(function(){var i,r;t.timers.ipgTimeoutTime>0&&(i=parseInt((t.timers.ipgTimeoutTime-$.now())/1e3),t.info.timer.html(ipgcommon.secondsToPersianMinutesSeconds(i)),i<60&&t.info.timer.parent().addClass("red-text"),i<=0&&(clearInterval(n),t.timers.ipgTimeoutTime=-1,t.confirmBtn.off("click"),t.confirmBtn.prop("disabled",!0),t.confirmBtn.text("تراکنش منقضی شد"),t.info.timer.html(ipgcommon.toPersianNumber("00:00")),t.sendDynamicSecondPassBtn.off("click"),t.sendDynamicSecondPassBtn.prop("disabled",!0),t.sendDynamicSecondPassBtn.text("تراکنش منقضی شد"),t.captchaImageRefresh.off("click"),t.captchaImageRefresh.prop("disabled",!0),t.captchaAudioPlay.off("click"),t.captchaAudioPlay.prop("disabled",!0)));t.timers.secondPassTimeoutTime>0&&(r=parseInt((t.timers.secondPassTimeoutTime-$.now())/1e3),r>0?t.sendDynamicSecondPassBtn.text("ارسال شد. درخواست مجدد "+ipgcommon.secondsToPersianMinutesSeconds(r)):(t.timers.secondPassTimeoutTime=-1,t.manageDynamicSecondPass(t.pan.getPanShowingText()),messageBox.clear().addError("چنانچه قبلا نسبت به پویاسازی رمز دوم خود اقدام نموده و از صحت اطلاعات وارد شده اطمینان دارید ولی هنوز رمز دوم پویا را دریافت نکرده اید، مجددا دکمه درخواست رمز پویا را بفشارید").show(),ipgcommon.scrollTop(t.notification.offset().top+100-$(window).height())))},950)},init:function(){t.timers.ipgTimeoutTime=$.now()+n.mainPageTimeoutInSeconds*1e3;t.timers.startTimer()}},info:{title:$("#tran-info-title"),timer:$(".timer"),amount:$("#tran-amount"),merchantName:$("#tran-merchant-name"),merchantMarketPlaceShopName:$("#tran-merchant-marketplace-shop-name"),merchantCode:$("#tran-merchant-code"),merchantSite:$("#tran-merchant-site"),pardakhtYarMerchantName:$("#tran-pardakhtyar-name"),pardakhtYarMerchantCode:$("#tran-pardakhtyar-code"),bill:$(".bill"),billId:$("#tran-bill-id"),payId:$("#tran-pay-id"),billOrganization:$("#tran-bill-organization"),merchantLogoPlace:$(".merchant-logo-place"),merchantLogo:$("#merchant_logo"),init:function(){t.info.amount.text(ipgcommon.toPersianNumber(ipgcommon.toCommaSeprated(n.price)));t.info.merchantName.text(n.vahedeTejariDs);t.info.merchantMarketPlaceShopName.text(n.merchantMarketPlaceShopName);t.info.merchantCode.text(ipgcommon.toPersianNumber(n.vahedeTejariSn+"/"+n.terminalId));n.pardakhtYarVahedeTejariSN&&($(".pardakhtYarInfo").fadeIn(),$(".ordinary").fadeOut(0),t.info.pardakhtYarMerchantCode.text(ipgcommon.toPersianNumber(n.pardakhtYarVahedeTejariSN+"/"+n.pardakhtYarVahedeTerminalId)),t.info.pardakhtYarMerchantName.text(n.pardakhtYarVahedeTejariDs));t.info.merchantSite.text(n.merchantUrl);n.serviceType===ipgcommon.serviceType.bill?(t.info.title.text("اطلاعات قبض"),t.info.billId.text(ipgcommon.toPersianNumber(n.billInfoDto.billId)),t.info.payId.text(ipgcommon.toPersianNumber(n.billInfoDto.payId)),t.info.billOrganization.text(ipgcommon.toPersianNumber(n.billInfoDto.billOrganization))):t.info.bill.fadeOut(0);n.logoImageUrl?t.info.merchantLogo.attr("src",n.logoImageUrl):t.info.merchantLogoPlace.fadeOut(0)}},receipt:{receiptPage:$("#receipt-page"),receiptOkBtn:$("#receipt-ok-btn"),additionalData:$("#additionalData"),show:function(i){var f,u,r;t.mainPage.fadeOut(0);t.ipgHelpPage.fadeOut(0);t.secondPassHelpPage.fadeOut(0);t.securityInfoPage.fadeOut(0);t.receipt.receiptPage.fadeIn(0);t.receipt.additionalData.fadeIn(0);u=function(){clearInterval(f);t.postBack(i)};$("#shaparakTerminalNumber").text(ipgcommon.toPersianNumber(i.shaparakTerminalNumber));$("#additionalData").text(i.additionalData);$("#transTime").text(ipgcommon.toPersianNumber(i.transactionTime));n.merchantMarketPlaceShopName!==null?$("#shopName").text(n.merchantMarketPlaceShopName):$("#shopName").text(n.vahedeTejariDs);$("#merchantUrl").text(n.merchantUrl);$("#terminalId").text(ipgcommon.toPersianNumber(n.terminalId));$("#merchant-terminal-id").text(ipgcommon.toPersianNumber(n.vahedeTejariSn+" / "+n.terminalId));n.pardakhtYarVahedeTejariDs?$("#pardakhtYarName").text(n.pardakhtYarVahedeTejariDs):$(".pardakhtYar").fadeOut(0);$("#rrn").text(ipgcommon.toPersianNumber(i.rrn));$("#saleId").text(ipgcommon.toPersianNumber(i.saleOrderId));$("#purchaseIdForGovernmentalMerchants").text(i.purchaseIdForGovernmentalMerchants);$("#transType").text("خرید");$("#cardNumber").text(i.cardNumberLastFourDigit+"******"+i.cardNumberBin);$("#issuerBank").text($(".bincode").text());$("#price").text(ipgcommon.toPersianNumber(n.price)+" (ریال)");$("#paygateTranId").text(ipgcommon.toPersianNumber(i.paygateTranId));$(".purchaseIdForOrgan").fadeOut(0);(n.serviceType===ipgcommon.serviceType.jud||n.serviceType===ipgcommon.serviceType.iranInsurance||n.serviceType===ipgcommon.serviceType.SabtAsnad)&&$(".purchaseIdForOrgan").fadeIn();n.serviceType===ipgcommon.serviceType.bill?($("#transType").text("پرداخت قبض"),$("#billId").text(ipgcommon.toPersianNumber(n.billInfoDto.billId)),$("#payId").text(ipgcommon.toPersianNumber(n.billInfoDto.payId)),$("#billOrganization").text(n.billInfoDto.billOrganization)):$(".bill").fadeOut(0);n.serviceType===ipgcommon.serviceType.telecomChargeMci||n.serviceType===ipgcommon.serviceType.telecomChargePinMci||n.serviceType===ipgcommon.serviceType.telecomChargeIrancell||n.serviceType===ipgcommon.serviceType.telecomChargePinIrancell||n.serviceType===ipgcommon.serviceType.telecomChargeRightel||n.serviceType===ipgcommon.serviceType.telecomChargePinRightel||n.serviceType===ipgcommon.serviceType.telecomChargeAzartel||n.serviceType===ipgcommon.serviceType.telecomChargeAptel||n.serviceType===ipgcommon.serviceType.telecomChargeShatel?$("#transType").text("خرید شارژ"):(n.serviceType===ipgcommon.serviceType.telecomBoltonMci||n.serviceType===ipgcommon.serviceType.telecomBoltonIrancell||n.serviceType===ipgcommon.serviceType.telecomBoltonRightel||n.serviceType===ipgcommon.serviceType.telecomBoltonAzartel||n.serviceType===ipgcommon.serviceType.telecomBoltonShatel||n.serviceType===ipgcommon.serviceType.telecomBoltonAptel)&&$("#transType").text("خرید بسته");r=n.receiptPageTimeoutInSeconds;f=setInterval(function(){r--;$("#remaining-time").text(ipgcommon.toPersianNumber(r));r<=0&&(t.receipt.receiptOkBtn.off("click"),$("#remaining-time").text(ipgcommon.toPersianNumber("0")),t.receipt.receiptOkBtn.prop("disabled",!0),u())},1e3);t.receipt.receiptOkBtn.on("click",u)}},serializeData:function(){var i={RefId:n.refId,CardNumber:t.pan.getPan(),CardToken:t.pan.getToken(),Cvv2:t.cvv2.val(),Exp:t.expiryYear.val()+t.expiryMonth.val(),SecondPass:t.secondPass.val(),Mobile:n.mobile,MobileNotification:t.phoneNumber.val(),Email:t.mailAddress.val(),Captcha:t.captcha.val(),SaveCardNumber:t.saveCardCheckbox.prop("checked")};return JSON.stringify(i)},postBack:function(t){if(n.serviceType===ipgcommon.serviceType.iranInsurance){t.iranInsuranceExtraDataDto.merchantShaparakFee=t.merchantShaparakFee;ipgcommon.iranInsuranceCustomPostback(t.callbackUrl,t.iranInsuranceExtraDataDto);return}var i=t.encryptedReturningParams?{ReturningParams:t.encryptedReturningParams,PayGateTranID:t.paygateTranId,MerchantShaparakFee:t.merchantShaparakFee}:{MerchantShaparakFee:t.merchantShaparakFee};ipgcommon.createAndSubmitForm(ipgcommon.decodeHtml(t.callbackUrl),i,"post",!1)},enableWebOtp:function(){try{"OTPCredential"in window&&navigator.credentials.get({otp:{transport:["sms"]}}).then(function(n){t.secondPass.val(n.code)}).catch(function(n){console.log(n);throw"Failed to perform WebOTP: "+n;})}catch(n){console.log("enableWebOtp Failed!!!")}},init:function(){t.receipt.receiptPage.fadeOut(0);t.changeExpBtn.fadeOut();t.dynamicSecondPassGiftCardWrapper.fadeOut();n.canStoreCards?t.saveCardCheckbox.prop("checked",!0).addClass("checked"):(t.saveCardCheckbox.prop("checked",!1).removeClass("checked"),t.saveCardCheckbox.parent().fadeOut());t.captchaImage.attr("src","data:image/jpeg;charset=utf-8;base64, "+n.captchaGetDto.imageBase64);n.enableAudioCaptcha&&t.captchaAudioPlay.fadeIn();n.defaultError&&(messageBox.clear().addError(n.defaultError).show(),ipgcommon.scrollTop(t.notification.offset().top+100-$(window).height()));$(window).on("keydown",function(n){if(n.which===ipgcommon.keyCodes.enter&&!$(n.target).hasClass("card-item-new dont-close-cards")&&!$(n.target).hasClass("card-item dont-close-cards"))return t.confirmBtn.click(),n.preventDefault(),!1})}},i={documentClickHandler:function(n){$(n.target).closest(".dont-close-cards").length||t.cardElements.wrapper.fadeOut()},documentGestureStartHandler:function(n){n.preventDefault()},documentTouchMoveHandler:function(){r.isScrolling=!0},documentTouchEndHandler:function(n){r.isScrolling||$(n.target).closest(".dont-close-cards").length||t.cardElements.wrapper.fadeOut();r.isScrolling=!1},panFocusHandler:function(){t.cardElements.canShowWrapper()&&t.cardElements.wrapper.fadeIn();ipgcommon.scrollTop(t.pan.p1.closest("form").offset().top)},panKeyupHandler:function(n){var i,r,u;if(!n.target.readOnly){$(this).val(ipgcommon.toEnglishNumber($(this).val()));t.pan.selectedCard=undefined;t.cvv2Wrapper.fadeIn();t.expWrapper.fadeIn();i=t.pan.getPan();t.onCardNumberChanged(i);if(t.cardElements.getAll().each(function(n){return function(i,r){var u=$(r),f=t.cardElements.getCardNumberFrom(u);f.indexOf(n)===0?(u.fadeIn(),t.cardElements.setCardNumberTo(u,n,f.replace(n,""))):(u.fadeOut(),t.cardElements.setCardNumberTo(u,"",f))}}(ipgcommon.getMasked(i))),r=$(this).val(),r.length===0&&n.which===8?$(this).parent().prev("div").find("input").focus():r.length>=4&&n.which!==8&&(u=$(this).parent().next("div").find("input"),u.focus()),i.length===16){t.cardElements.wrapper.fadeOut();t.cvv2.focus();return}}},panKeydownHandler:function(n){if(!ipgcommon.isAllowedKey(n,!0,[ipgcommon.keyCodes.back,ipgcommon.keyCodes.arrowDown,ipgcommon.keyCodes.tab])){n.preventDefault();return}if(n.which===ipgcommon.keyCodes.arrowDown){t.cardElements.getNew().focus();n.preventDefault();return}var i=$(this).val();i===""&&n.which===8?$(this).parent().prev("div").find("input").focus():i.length>=4&&n.which!==8&&$(this).parent().next("div").find("input").focus()},onlyDigitsKeydownHandler:function(n){if(!ipgcommon.isAllowedKey(n,!0,[ipgcommon.keyCodes.back,ipgcommon.keyCodes.tab])){n.preventDefault();return}},onlyDigitsReplaceToEnglishKeyupHandler:function(){$(this).val(ipgcommon.toEnglishNumber($(this).val()))},panPasteHandler:function(n){var i=n.originalEvent.clipboardData.getData("text");if(i=i.replace(/\s+/g,"").replace(/-+/g,""),i=ipgcommon.toEnglishNumber(i),n.preventDefault(),!isNaN(i)&&i.length===16){t.pan.p1.val(i.substr(0,4));t.pan.p2.val(i.substr(4,4));t.pan.p3.val(i.substr(8,4));t.pan.p4.val(i.substr(12,4));t.onCardNumberChanged(i);t.cardElements.wrapper.fadeOut();t.cvv2.focus()}},cvv2KeyupHandler:function(n){var i=$(this).val();i.length===4&&n.which!==ipgcommon.keyCodes.back?t.expiryMonth.prop("disabled")||t.expiryMonth.val()!==""?t.captcha.focus():t.expiryMonth.focus():i.length>4&&(t.expiryMonth.val(i.substr(0,4)),t.expiryMonth.prop("disabled")||t.expiryMonth.val()!==""?t.captcha.focus():t.expiryMonth.focus())},expiryMonthKeyupHandler:function(n){var i=$(this).val();i.length===2&&n.which!==ipgcommon.keyCodes.back?t.expiryYear.focus():i.length>2&&(t.expiryMonth.val(i.substr(0,2)),t.expiryYear.focus())},expiryYearKeyupHandler:function(n){var i=$(this).val();i.length===2&&n.which!==ipgcommon.keyCodes.back?t.captcha.focus():i.length>2&&(t.expiryYear.val(i.substr(0,2)),t.captcha.focus())},captchaKeyupHandler:function(n){var i=$(this).val();i.length===5&&n.which!==ipgcommon.keyCodes.back?t.secondPass.focus():i.length>5&&(t.captcha.val(i.substr(0,5)),t.secondPass.focus())},cvv2FocusHandler:function(){$(".keypad-pass-active").hide()},secondPassFocusHandler:function(){$(".keypad-cvv2-active").hide()},captchaImageRefreshClickHandler:function(){t.refreshCaptcha();t.captcha.focus()},captchaAudioPlayClickHandler:function(){t.playCaptcha();t.captcha.focus()},changeExpHandler:function(){t.enableExpiry();t.expiryMonth.focus()},clearOnDblclickHandler:function(n){n.target.readOnly||$(n.target).val("")},checkBoxChangeHandler:function(){$(this).toggleClass("checked")},sendDynamicSecondPassHandler:function(){if(messageBox.clear(),$("#payForm").reset(),!$("#pan-wrapper-element").valid()|!$("#captcha-wrapper").valid()|!$("#exp-wrapper").valid()|!$("#cvv2-wrapper").valid()){ipgcommon.scrollTop(t.pan.p1.closest("form").offset().top);return}if(!t.cardHistory.isAllowd(t.pan.getPanShowingText())){messageBox.clear().addError("مهلت درخواست مجدد رمز برای این کارت هنوز به پایان نرسیده است").show();return}t.confirmBtn.prop("disabled",!0);t.cancelBtn.prop("disabled",!0);t.sendDynamicSecondPassBtn.prop("disabled",!0);t.sendDynamicSecondPassBtn.text(" ارسال ...");t.sendDynamicSecondPassBtn.addClass("button_loading");var r={RefId:n.refId,CardNumber:t.pan.getPan(),CardToken:t.pan.getToken(),Captcha:t.captcha.val()},i={};i[ipgcommon.antiforgery.headerPropName]=ipgcommon.antiforgery.antiforgeryElement.val();$.ajax({url:ipgcommon.getBase()+"api/default/senddynamicsecondpass",type:"POST",headers:i,data:JSON.stringify(r),contentType:"application/json; charset=utf-8",success:function(){messageBox.clear().addSuccess("درخواست شما به بانک صادرکننده ارسال گردید").show();t.pan.pAll.prop("disabled",!0);t.cvv2.prop("disabled",!0);t.cvv2.keypad("disable");t.expiryMonth.prop("disabled",!0);t.expiryYear.prop("disabled",!0);t.changeExpBtn.prop("disabled",!0);t.confirmBtn.prop("disabled",!1);t.cancelBtn.prop("disabled",!1);t.sendDynamicSecondPassBtn.removeClass("button_loading");t.pan.selectedCard&&ipgcommon.isWalletCard(t.pan.selectedCard)?t.cardHistory.add(t.pan.selectedCard.bin+"******"+t.pan.selectedCard.lastDigits,$.now()+n.secondPassTimeoutInSeconds*1e3):t.cardHistory.add(t.pan.getPanShowingText(),$.now()+n.secondPassTimeoutInSeconds*1e3);t.timers.secondPassTimeoutTime=$.now()+n.secondPassTimeoutInSeconds*1e3;t.captchaWrapper.fadeOut()},error:function(n){if(t.refreshCaptcha(),t.pan.pAll.prop("disabled",!1),t.cvv2.prop("disabled",!1),t.cvv2.keypad("enable"),t.expiryMonth.prop("disabled",!1),t.expiryYear.prop("disabled",!1),t.changeExpBtn.prop("disabled",!1),t.confirmBtn.prop("disabled",!1),t.cancelBtn.prop("disabled",!1),t.sendDynamicSecondPassBtn.prop("disabled",!1),t.sendDynamicSecondPassBtn.text("درخواست رمز پویا"),t.sendDynamicSecondPassBtn.removeClass("button_loading"),n.status===409){var i=n.responseJSON;messageBox.clear().addError(i.errorString).show();ipgcommon.scrollTop(t.notification.offset().top+100-$(window).height())}else throw"Failed to Send Dynamic Second Pass: "+n.status+" "+JSON.stringify(n);}})},cancelHandler:function(){messageBox.clear();var i={};i[ipgcommon.antiforgery.headerPropName]=ipgcommon.antiforgery.antiforgeryElement.val();t.sendDynamicSecondPassBtn.prop("disabled",!0);t.confirmBtn.prop("disabled",!0);t.cancelBtn.prop("disabled",!0);t.cancelBtn.text(" انصراف ...");t.cancelBtn.addClass("button_loading");$.ajax({url:ipgcommon.getBase()+"api/default/cancel",type:"POST",headers:i,data:JSON.stringify({refId:n.refId}),contentType:"application/json; charset=utf-8",success:function(t){if(n.serviceType===ipgcommon.serviceType.iranInsurance){t.iranInsuranceExtraDataDto.merchantShaparakFee=0;ipgcommon.iranInsuranceCustomPostback(t.callbackUrl,t.iranInsuranceExtraDataDto);return}var i=t.encryptedReturningParams?{ReturningParams:t.encryptedReturningParams}:{};ipgcommon.createAndSubmitForm(ipgcommon.decodeHtml(t.callbackUrl),i,"post",!1)},error:function(n){t.cancelBtn.prop("disabled",!1);t.cancelBtn.text(" انصراف");t.cancelBtn.removeClass("button_loading");throw"Failed to Cancel: "+n.status+" "+JSON.stringify(n);}})},confirmHandler:function(){if(messageBox.clear(),!$("#payForm").valid()){ipgcommon.scrollTop(t.pan.p1.closest("form").offset().top);return}if(!t.confirmBtn.data("processing")){t.confirmBtn.data("processing",!0);t.confirmBtn.prop("disabled",!0);t.cancelBtn.prop("disabled",!0);t.confirmBtn.text(" پرداخت ...");t.confirmBtn.addClass("button_loading");var i={};i[ipgcommon.antiforgery.headerPropName]=ipgcommon.antiforgery.antiforgeryElement.val();$.ajax({url:ipgcommon.getBase()+"api/default/confirm",type:"POST",headers:i,data:t.serializeData(),contentType:"application/json; charset=utf-8",success:function(i){if(i.newRefId){ipgcommon.createAndSubmitForm(ipgcommon.getBase(),{RefId:i.newRefId,mobileap:n.mobile},"post",!1);return}messageBox.clear().addSuccess("عملیات پرداخت با موفقیت انجام پذیرفت.").show();t.cardElements.addToLastUsedCards(i.cardNumberLastFourDigit);n.enableReceipt?t.receipt.show(i):t.postBack(i)},error:function(n){if(t.refreshCaptcha(),t.confirmBtn.prop("disabled",!1),t.cancelBtn.prop("disabled",!1),t.confirmBtn.text("پرداخت"),t.confirmBtn.removeClass("button_loading"),n.status===409){var i=n.responseJSON;messageBox.clear().addError(i.errorString).show();t.secondPass.val("");t.cvv2.prop("disabled",!1);t.cvv2.keypad("enable");t.expiryMonth.prop("disabled",!1);t.expiryYear.prop("disabled",!1);t.changeExpBtn.prop("disabled",!1);ipgcommon.scrollTop(t.notification.offset().top+100-$(window).height())}else throw"Failed to Confirm: "+n.status+" "+JSON.stringify(n);},complete:function(){t.confirmBtn.data("processing",!1)}})}},setHandlers:function(){$(document).on("gesturestart",i.documentGestureStartHandler);$(document).on("click",i.documentClickHandler);$(document).on("touchmove",i.documentTouchMoveHandler);$(document).on("touchend",i.documentTouchEndHandler);t.pan.pAll.on("keyup",i.panKeyupHandler);t.pan.pAll.on("focus",i.panFocusHandler);t.pan.pAll.on("keydown",i.panKeydownHandler);t.pan.pAll.on("paste",i.panPasteHandler);t.pan.pAll.on("dblclick",i.clearOnDblclickHandler);t.pan.pAll.on("dblclick",i.panKeyupHandler);t.expiryMonth.on("keyup",i.onlyDigitsReplaceToEnglishKeyupHandler);t.expiryMonth.on("keyup",i.expiryMonthKeyupHandler);t.expiryMonth.on("keydown",i.onlyDigitsKeydownHandler);t.expiryMonth.on("dblclick",i.clearOnDblclickHandler);t.expiryYear.on("keyup",i.onlyDigitsReplaceToEnglishKeyupHandler);t.expiryYear.on("keyup",i.expiryYearKeyupHandler);t.expiryYear.on("keydown",i.onlyDigitsKeydownHandler);t.expiryYear.on("dblclick",i.clearOnDblclickHandler);t.sendDynamicSecondPassBtn.on("click",i.sendDynamicSecondPassHandler);t.changeExpBtn.on("click",i.changeExpHandler);t.cancelBtn.on("click",i.cancelHandler);t.confirmBtn.on("click",i.confirmHandler);t.secondPass.on("focus",i.secondPassFocusHandler);t.secondPass.on("keyup",i.onlyDigitsReplaceToEnglishKeyupHandler);t.secondPass.on("keydown",i.onlyDigitsKeydownHandler);t.secondPass.on("dblclick",i.clearOnDblclickHandler);t.secondPass.keypad({prompt:"صفحه کلید امن",showOn:"button",buttonImageOnly:!0,buttonImage:"images/keypad.png",randomiseNumeric:!0,keypadOnly:!1,keypadClass:"keypad-pass-active",onClose:function(){t.secondPass.focus()}});t.cvv2.on("focus",i.cvv2FocusHandler);t.cvv2.on("keyup",i.onlyDigitsReplaceToEnglishKeyupHandler);t.cvv2.on("keyup",i.cvv2KeyupHandler);t.cvv2.on("keydown",i.onlyDigitsKeydownHandler);t.cvv2.on("dblclick",i.clearOnDblclickHandler);t.cvv2.keypad({prompt:"صفحه کلید امن",showOn:"button",buttonImageOnly:!0,buttonImage:"images/keypad.png",randomiseNumeric:!0,keypadOnly:!1,keypadClass:"keypad-cvv2-active",onClose:function(){t.cvv2.focus()}});t.captcha.on("keyup",i.onlyDigitsReplaceToEnglishKeyupHandler);t.captcha.on("keydown",i.onlyDigitsKeydownHandler);t.captcha.on("keyup",i.captchaKeyupHandler);t.captcha.on("dblclick",i.clearOnDblclickHandler);t.captchaImageRefresh.on("click",i.captchaImageRefreshClickHandler);t.captchaAudioPlay.on("click",i.captchaAudioPlayClickHandler);t.phoneNumber.on("keyup",i.onlyDigitsReplaceToEnglishKeyupHandler);t.saveCardCheckbox.on("change",i.checkBoxChangeHandler)},deleteCardHandler:function(t){t.preventDefault();t.stopImmediatePropagation();const i=$(this).closest(".card-item"),u=i.prop("id");var r={};r[ipgcommon.antiforgery.headerPropName]=ipgcommon.antiforgery.antiforgeryElement.val();$.ajax({url:ipgcommon.getBase()+"api/default/delete-card",type:"POST",headers:r,data:JSON.stringify({cardToken:u,refId:n.refId}),contentType:"application/json; charset=utf-8",success:function(){i.remove();messageBox.clear().addSuccess("کارت با موفقیت حذف شد.").show()},error:function(){messageBox.clear().addError("خطا در حذف کارت").show()}})}};$(function(){t.init();t.info.init();t.timers.init();t.cardElements.init();i.setHandlers();$(document).on("click","#delete-card",i.deleteCardHandler)})}(window.mainViewModel);